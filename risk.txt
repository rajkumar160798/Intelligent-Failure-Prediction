SELECT
  COALESCE(v.session_id, ah.session_id) AS session_id,
  
  -- Session Presence
  CASE 
    WHEN v.session_id IS NOT NULL AND ah.session_id IS NOT NULL THEN 'Both'
    WHEN v.session_id IS NOT NULL THEN 'Visit Only'
    WHEN ah.session_id IS NOT NULL THEN 'AH Only'
  END AS session_presence,

  -- Timing
  v.visit_start_date_time AS visit_start_time,
  ah.visit_start_date_time AS ah_visit_start_time,
  v.visit_end_date_time AS visit_end_time,
  ah.visit_end_date_time AS ah_visit_end_time,
  v.visit_duration_seconds AS visit_duration,
  ah.visit_duration_seconds AS ah_visit_duration,

  -- Identity
  v.individual_analytics_identifier AS visit_indv_id,
  ah.individual_analytics_identifier AS ah_indv_id,

  -- Channel Information
  v.mobile_web AS visit_mobile_web,
  ah.web_mobile AS ah_mobile_web,

  -- Login Behavior
  v.first_login_date_time,
  ah.first_visit_date_time AS ah_first_visit,

  ah.ah_successful_login,
  ah.test_member_indicator

FROM visit v
FULL OUTER JOIN ah_visit ah
  ON v.session_id = ah.session_id
